# PEP 659 – Specializing Adaptive Interpreter


对单个字节码进行优化。

专业化（specializing）:  现在的字节码是多功能的，一个字节码做很多类似的事，现在给这些字节码再进行细分，使得生成对应字节码的一个指令族，每个指令族里的指令都做单一的事，从而会比原来的字节码运行的更快。

自适应（adaptive）： 为这些字节码添加一个计数器，哪个功能用的多就增加，超过一定数值就使用该功能对应的专业化指令替代原来字节码，从而进行加速代码执行。当出现不命中专业化指令时，退化为使用原字节码，并减少对应的计数，下降到一定数据后退化为原来的字节码。


利用了局部性原理，其实就是优化大的`for` 循环内的指令码，所以其实`for` 循环内的代码也应该尽量一致，使得能一直保持使用专业化指令，如果在专业化指令和原字节码之间反复横跳，性能反而下降。

> the sole test of the validity of any idea is experiment.


[PEP-659](https://peps.python.org/pep-0659)